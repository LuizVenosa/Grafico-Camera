---
title: "R_test"
output: html_document
date: "2024-10-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



```{r}
regress2022_dados$percentage_votos_centrao <- regress2022_dados$percentage_votos_centrao*100
```



```{r}
reg1 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao), data=regress2022_dados)
```

```{r}
summary(reg1)
```
```{r}
reg2 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + Impostos, data=regress2022_dados)
```


```{r}
summary(reg2)
```


```{r}
regress2022_dados$vab <- relevel(factor(regress2022_dados$vab), ref = "Produção florestal, pesca e aquicultura")

reg3 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + Impostos + vab, data=regress2022_dados)
summary(reg3)
```

```{r}
reg4 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + factor(uf), data = regress2022_dados)
summary(reg4)
```

```{r}
colnames(bolsa_fam)[2] <- "ibge"
colnames(bolsa_fam)[4] <- "num_bolsa"
regress2022_dados <- regress2022_dados %>%  left_join(select(bolsa_fam, ibge, num_bolsa), by="ibge")
```

```{r}
reg5 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao)+ log(Impostos) + num_bolsa, data = regress2022_dados)
summary(reg5)
```
```{r}
regress2022_dados$percent_bolsa <- (regress2022_dados$num_bolsa / regress2022_dados$populacao)*100
reg6 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa, data = regress2022_dados)
summary(reg6)
```

```{r}
vif(reg6)
```
```{r}
ggplot(data=sample_n(regress2022_dados, 5000), aes(taxa_analfabetismo, percentage_votos_centrao, color=regiao)) + geom_point()

```

```{r}
ggplot(data=sample_n(regress2022_dados, 2500), aes(taxa_analfabetismo, percentage_votos_centrao, color=`Administração, defesa, educação e saúde públicas e seguridade social`)) + geom_point() + theme(legend.position="bottom")
```
```{r}
ggplot(data=sample_n(regress2022_dados, 1000), aes(log(pib_per_capita), percentage_votos_centrao, color=regiao, size=populacao)) + geom_point() + theme(legend.position="bottom")
```
```{r}
mutinformation(discretize(regress2022_dados$percentage_votos_centrao), discretize(regress2022_dados$Impostos))

```

```{r}

reg7 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + factor(uf) , data = regress2022_dados)
summary(reg7)
```

```{r}
reg8 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + factor(regiao), data = regress2022_dados_teste)
summary(reg8)
```

```{r}
reg9 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + percent_bolsa * factor(regiao) , data = regress2022_dados)
summary(reg9)
```

```{r}
reg10 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + taxa_analfabetismo * factor(regiao) + percent_bolsa * factor(regiao) , data = regress2022_dados)
summary(reg10)
```
```{r}
emendas_cidade <- emendas %>% 
  group_by(`Favorecido do Pagamento (Município)`) %>%
  summarize(Total = sum(`Pago + RP (Favorecido lista OB) a órgãos do governo`))
emendas_cidade
```
```{r}
regress2022_dados_teste <- regress2022_dados %>%
  mutate(municipio = toupper(municipio)) %>%
  left_join(emendas_cidade, by = c("municipio" = "Favorecido do Pagamento (Município)")) %>%
  rename(Emendas = Total)
```

```{r}
reg10 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + log(Emendas), data = regress2022_dados_teste)
summary(reg10)
```
```{r}
ggplot(regress2022_dados_teste, aes(x = log(Emendas))) +
  geom_density(fill = "skyblue") +
  labs(title = "Distribution of Variable", x = "Your Variable", y = "Frequency")
```
```{r}
ggplot(regress2022_dados_teste, aes(x = percentage_votos_centrao)) +
  geom_density(fill = "skyblue") +
  labs(title = "Distribution of Variable", x = "Your Variable", y = "Frequency")
```

```{r}
ggplot(data=sample_n(regress2022_dados_teste, 2500), aes(log(Emendas), percentage_votos_centrao, color=regiao)) + geom_point() + theme(legend.position="bottom")
```
```{r}
mean(regress2022_dados_teste$Emendas, na.rm=TRUE)
median(regress2022_dados_teste$Emendas, na.rm=TRUE)
```

```{r}
reg11 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + factor(regiao)* log(Emendas), data = regress2022_dados_teste)
summary(reg11)
```
```{r}
reg12 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa *factor(regiao) + factor(regiao)* log(Emendas), data = regress2022_dados_teste)
summary(reg12)
```

```{r}
reg12 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa + factor(regiao) + log(Emendas), data = regress2022_dados_teste)
summary(reg12)
```
```{r}
reg13 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao)  + factor(regiao)*log(Emendas), data = regress2022_dados_teste)
summary(reg13)
```
```{r}
reg14 <- lm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + log(populacao) + percent_bolsa+ factor(uf) + log(Emendas), data = regress2022_dados_teste)
summary(reg14)
```



```{r}
group_means_table <- regress2022_dados_teste %>%
         group_by(uf) %>%
         summarize(mean_value = mean(Emendas/populacao, na.rm = TRUE),
                   mean_perc = mean(percentage_votos_centrao, na.rm = TRUE)) 
scaling_factor <- max(group_means_table$mean_value) / max(group_means_table$mean_perc)
      
ggplot(group_means_table) +
  geom_point(aes(x = reorder(uf, mean_perc), y = mean_value), size = 3, color = "blue") +
  geom_point(aes(x = reorder(uf, mean_perc), y = mean_perc * scaling_factor, size = 3, color = "red")) +
  labs(title = "Mean of Variable by Group with Error Bars", x = "Group", y = "Mean Value") +
   scale_y_continuous(
    name = "Mean Value",
    
    # Secondary y-axis (inverted scaling factor)
    sec.axis = sec_axis(~ . / scaling_factor, name = "Vote Percentage")
  ) +

  theme_minimal()+
  theme(
    axis.title.y.left = element_text(color = "blue"),
    axis.title.y.right = element_text(color = "red")
  )
```

```{r}
regress2022_dados_teste$percentage_votos_centrao <- regress2022_dados_teste$percentage_votos_centrao/100
regress2022_dados_teste$taxa_analfabetismo <- regress2022_dados_teste$taxa_analfabetismo/100
regress2022_dados_teste$percent_bolsa <- regress2022_dados_teste$percent_bolsa/100
```
```{r}
regress2022_dados_teste <- regress2022_dados_teste %>%
  filter(!is.na(percentage_votos_centrao), 
         !is.na(taxa_analfabetismo), 
         !is.na(log(pib_per_capita)),
         !is.na(log(populacao)),
         !is.na(percent_bolsa),
         !is.na(log(Emendas)))
```


```{r}
# Fit the linear mixed model
lmm_model <- lmer(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + 
                  log(populacao) + percent_bolsa + log(Emendas) + (1 | uf), data = regress2022_dados_teste)

# Summary of the model
summary(lmm_model)
```
```{r}
regress2022_dados_teste <- regress2022_dados_teste %>% 
  mutate(percentage_votos_centrao = percentage_votos_centrao + 0.00001)

```


```{r}

# Fit the generalized linear mixed model
glmm_model <- glmer(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + 
                    log(populacao) + percent_bolsa + log(Emendas) + (1 | uf), 
                    family = binomial(link = "logit"), data = regress2022_dados_teste)

# Summary of the model
summary(glmm_model)


```
```{r}
glmm_model_region <- glmer(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) + 
                    log(populacao) + percent_bolsa + log(Emendas) + (1 | regiao), 
                    family = binomial(link = "logit"), data = regress2022_dados_teste)

# Summary of the model
summary(glmm_model_region)
```


```{r}
model_quasi <- glmmTMB(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                       log(populacao) + percent_bolsa + log(Emendas) + (1 | uf),
                       data = regress2022_dados_teste,
                       family = binomial(link = "logit"),
                       dispformula = ~1)
summary(model_quasi)
```

```{r}
quasi_binomial_model <- glm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas),
                            data = regress2022_dados_teste,
                            family = quasibinomial(link = "logit"))
summary(quasi_binomial_model)

```
```{r}
beta_model <- betareg(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                      log(populacao) + percent_bolsa + log(Emendas), 
                      data = regress2022_dados_teste)
summary(beta_model)
```
```{r}
# Fit a beta regression with random intercepts for region
beta_mixed_model <- glmmTMB(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas) + (1 | regiao),
                            data = regress2022_dados_teste,
                            family = beta_family(link = "logit"))
summary(beta_mixed_model)
```

```{r}
# Fit a beta regression with random intercepts for region
beta_mixed_model_uf <- glmmTMB(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas) + (1 | uf),
                            data = regress2022_dados_teste,
                            family = beta_family(link = "logit"))
summary(beta_mixed_model_uf)
```

```{r}
beta_mixed_model_uf_sud <- glmmTMB(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas) + (1 | uf),
                            data = regress2022_dados_teste %>% filter(regress2022_dados_teste$regiao == "Sudeste"),
                            family = beta_family(link = "logit"))
summary(beta_mixed_model_uf_sud)
```

```{r}
quasi_binomial_model_sud <- glm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas)+ factor(uf),
                            data = regress2022_dados_teste %>% filter(regress2022_dados_teste$regiao=="Sudeste"),
                            family = quasibinomial(link = "logit"))
summary(quasi_binomial_model_sud)
```

```{r}
beta_mixed_model_uf_nord <- glmmTMB(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas) + (1 | uf),
                            data = regress2022_dados_teste %>% filter(regress2022_dados_teste$regiao == "Nordeste"),
                            family = beta_family(link = "logit"))
summary(beta_mixed_model_uf_nord)
```
```{r}
quasi_binomial_model_nord <- glm(percentage_votos_centrao ~ taxa_analfabetismo + log(pib_per_capita) +
                            log(populacao) + percent_bolsa + log(Emendas) + factor(uf),
                            data = regress2022_dados_teste %>% filter(regress2022_dados_teste$regiao=="Nordeste"),
                            family = quasibinomial(link = "logit"))
summary(quasi_binomial_model_nord)
```

